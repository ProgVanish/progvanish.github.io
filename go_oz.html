<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–∞–º–∏–Ω –û–∑</title>

  <!-- –®—Ä–∏—Ñ—Ç –¥–∏–Ω–∞–º–∏—á–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0f1220;
      --card: #161a2d;
      --text: #e8ebff;
      --muted: #9aa3c7;
      --accent: #5de6ff;
      --accent-2:#7cffb2;
      --focus: #9c7cff;
      --radius: 16px;
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 80% -10%, #2a2f55 0%, #171b31 45%, #0f1220 80%) no-repeat,
        linear-gradient(180deg, #0f1220 0%, #0f1220 100%);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    .wrap {
      min-height: 140vh;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .card {
      width: min(720px, 100%);
      background: color-mix(in hsl, var(--card) 92%, black 8%);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: var(--radius);
      padding: clamp(18px, 4vw, 28px);
      box-shadow: 0 20px 60px rgba(12, 16, 40, 0.6), inset 0 0 0 1px rgba(255,255,255,0.02);
      backdrop-filter: blur(6px);
    }

    .header { display: flex; align-items: center; justify-content: center; gap: 14px; margin-bottom: clamp(16px, 3.5vw, 28px); text-align: center; }
    .brand {
      font-family: 'Orbitron', system-ui, sans-serif;
      font-weight: 800; font-size: clamp(28px, 5vw, 56px);
      letter-spacing: 0.06em; text-transform: uppercase; line-height: 1.1;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 0 22px rgba(93, 230, 255, 0.12);
      animation: dash 3.6s ease-in-out infinite;
    }
    @keyframes dash { 0%{letter-spacing:.06em; text-shadow:0 0 22px rgba(93,230,255,.12);} 50%{letter-spacing:.085em; text-shadow:0 0 28px rgba(93,230,255,.18);} 100%{letter-spacing:.06em; text-shadow:0 0 22px rgba(93,230,255,.12);} }
    .subtitle { color: var(--muted); font-size: clamp(13px, 2.5vw, 16px); margin-top: 8px; text-align: center; }

    .form { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; margin-top: 8px; }
    .input {
      width: 100%; padding: 16px 18px; border-radius: calc(var(--radius) - 6px);
      border: 1px solid rgba(255,255,255,0.10); background: rgba(255,255,255,0.04);
      color: var(--text); font-size: clamp(14px, 2.8vw, 16px); outline: none;
      transition: border-color .2s, box-shadow .2s, background-color .2s;
    }
    .input::placeholder { color: var(--muted); }
    .input:focus { border-color: var(--focus); box-shadow: 0 0 0 3px rgba(156,124,255,0.18); background: rgba(255,255,255,0.06); }

    .send {
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      padding: 12px 14px; border: 1px solid rgba(255,255,255,0.10);
      background: linear-gradient(180deg, rgba(93,230,255,0.18), rgba(124,255,178,0.14));
      color: var(--text); border-radius: calc(var(--radius) - 8px);
      cursor: pointer; transition: transform .08s ease, filter .2s ease, box-shadow .2s ease, background .2s ease;
    }
    .send:hover { filter: brightness(1.08); box-shadow: 0 8px 22px rgba(93,230,255,0.24); }
    .send:active { transform: translateY(1px) scale(0.99); }
    .send .icon { font-size: 22px; }

    /* FAB */
    .fab {
      position: fixed; right: 20px; bottom: 20px; width: 56px; height: 56px;
      border-radius: 50%; border: 1px solid rgba(255,255,255,0.10);
      background: linear-gradient(180deg, rgba(156,124,255,0.25), rgba(93,230,255,0.18));
      color: var(--text); display: grid; place-items: center; cursor: pointer;
      box-shadow: 0 10px 30px rgba(12,16,40,0.6);
      opacity: 0; transform: translateY(20px); pointer-events: none;
      transition: opacity .25s ease, transform .25s ease; z-index: 20;
    }
    .fab.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .fab .icon { font-size: 24px; }

    /* –ú–æ–¥–∞–ª–∫–∏ */
    .modal { position: fixed; inset: 0; display: grid; place-items: center;
      background: rgba(6, 8, 20, 0.55); backdrop-filter: blur(6px);
      opacity: 0; pointer-events: none; transition: opacity .2s ease; z-index: 50; }
    .modal.show { opacity: 1; pointer-events: auto; }
    .modal-card {
      width: min(560px, calc(100% - 32px)); background: color-mix(in hsl, var(--card) 92%, black 8%);
      border: 1px solid rgba(255,255,255,0.08); border-radius: var(--radius); padding: 20px;
      box-shadow: 0 20px 60px rgba(12,16,40,0.7); animation: pop .2s ease;
    }
    @keyframes pop { from { transform: scale(0.98); opacity: .8; } to { transform: scale(1); opacity: 1; } }
    .modal-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .modal-header h3 { margin: 0; font-size: 20px; font-weight: 700; }
    .modal-body { color: var(--text); }

    @media (max-width: 540px) {
      .form { grid-template-columns: 1fr; }
      .send { padding: 14px 16px; }
    }

    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }

    /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏-–∫–∞–Ω–≤–∞—Å –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
    #confetti-canvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 60; /* –≤—ã—à–µ –º–æ–¥–∞–ª–æ–∫ */
      display: none; /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç */
    }
    #confetti-canvas.show { display: block; }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" role="form" aria-labelledby="title">
      <div class="header">
        <h1 id="title" class="brand">–ö–∞–º–∏–Ω –û–∑</h1>
      </div>
      <p class="subtitle">–°–º–µ–ª–æ –≤–ø–µ—Ä—ë–¥ ‚Äî –∫—É—Ä—Å –Ω–∞ –∏–∑—É–º—Ä—É–¥–Ω—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã.</p>

      <form class="form" id="oz-form" autocomplete="on">
        <label for="goal" class="sr-only">–¶–µ–ª—å –ø–æ—Ö–æ–¥–∞ –≤ –°—Ç—Ä–∞–Ω—É –û–∑</label>
        <input
          id="goal" class="input" type="text" name="goal"
          placeholder="–° –∫–∞–∫–æ–π —Ü–µ–ª—å—é –∏–¥—ë–º –≤ –°—Ç—Ä–∞–Ω—É –û–∑?" aria-label="–° –∫–∞–∫–æ–π —Ü–µ–ª—å—é –∏–¥—ë–º –≤ –°—Ç—Ä–∞–Ω—É –û–∑?" required
        />
        <button class="send" type="submit" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ü–µ–ª—å">
          <span class="icon" aria-hidden="true">üèÉ‚Äç‚ôÇÔ∏è</span>
        </button>
      </form>
    </section>
  </main>

  <!-- FAB (–∫–∞—Ä–∞–Ω–¥–∞—à) -->
  <button class="fab" id="fab" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">
    <span class="icon" aria-hidden="true">‚úèÔ∏è</span>
  </button>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
  <div class="modal" id="profile-modal" aria-hidden="true" role="dialog" aria-labelledby="profile-title">
    <div class="modal-card">
      <div class="modal-header">
        <span aria-hidden="true">üë§</span>
        <h3 id="profile-title">–ü—Ä–æ—Ñ–∏–ª—å</h3>
        <button class="btn" id="profile-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="modal-body">
        <form id="profile-form" class="profile-form" autocomplete="on">
          <div class="row">
            <label for="name">–ò–º—è</label>
            <input id="name" name="name" type="text" placeholder="–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?" />
          </div>
          <div class="row">
            <label for="interests">–ò–Ω—Ç–µ—Ä–µ—Å—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –∏–ª–∏ Enter ‚Äî —Ç–µ–≥–∏)</label>
            <input id="interests" name="interests" type="text" placeholder="–º—É–∑—ã–∫–∞, –±–µ–≥, —Ñ–∏–ª—å–º—ã, –¥–∏–∑–∞–π–Ω" />
          </div>
          <div class="row">
            <label for="about">–û —Å–µ–±–µ</label>
            <textarea id="about" name="about" placeholder="–ü–∞—Ä–∞ —Å–ª–æ–≤ –æ —Å–µ–±–µ..."></textarea>
          </div>
          <div class="actions">
            <button type="button" class="btn" id="clear-profile">–°–±—Ä–æ—Å–∏—Ç—å</button>
            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–∏—Å–∫–∞ -->
  <div class="modal" id="search-modal" aria-hidden="true" role="dialog" aria-labelledby="search-title">
    <div class="modal-card" style="text-align:center">
      <div class="modal-header" style="justify-content:center">
        <div class="spinner" aria-hidden="true"><div class="ring"></div></div>
        <h3 id="search-title" style="margin:0">–ò—â–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞</h3>
      </div>
      <div class="modal-body" style="display:flex; align-items:center; justify-content:center; gap:10px; color:var(--muted);">
        <span aria-hidden="true" style="font-size:22px; animation: spin 2s linear infinite; display:inline-block;">üîé</span>
        <span>–ø–æ–¥–±–∏—Ä–∞–µ–º –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º‚Ä¶</span>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ "–≠—Ç–æ –º–µ—Ç—á!" -->
  <div class="modal" id="match-modal" aria-hidden="true" role="dialog" aria-labelledby="match-title">
    <div class="modal-card">
      <div class="modal-header">
        <span aria-hidden="true">üéâ</span>
        <h3 id="match-title">–≠—Ç–æ –º–µ—Ç—á!</h3>
        <button class="btn" id="match-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="modal-body">
        <div id="match-name" style="font-size:18px; font-weight:700; margin-bottom:6px;"></div>
        <div id="match-about" style="color:var(--muted); margin-bottom:8px;"></div>
        <div style="margin-top:10px;">–í–∞—à–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã:</div>
        <div id="match-interests" style="color: var(--text); margin-top:6px;"></div>

        <button class="enter-btn" id="enter-room" style="margin-top:14px; display:inline-flex; align-items:center; gap:10px; padding:12px 16px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background: linear-gradient(180deg, rgba(93,230,255,0.18), rgba(124,255,178,0.14)); color: var(--text); cursor: pointer;">
          <span class="icon" aria-hidden="true">üö™</span>
          –≤–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É
        </button>
      </div>
    </div>
  </div>

  <!-- –ö–∞–Ω–≤–∞—Å –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ -->
  <canvas id="confetti-canvas"></canvas>

  <script>
    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const form = document.getElementById('oz-form');
    const fab = document.getElementById('fab');

    const profileModal = document.getElementById('profile-modal');
    const profileClose = document.getElementById('profile-close');
    const profileForm = document.getElementById('profile-form');
    const nameInput = document.getElementById('name');
    const interestsInput = document.getElementById('interests');
    const aboutInput = document.getElementById('about');
    const clearProfileBtn = document.getElementById('clear-profile');

    const searchModal = document.getElementById('search-modal');
    const matchModal = document.getElementById('match-modal');
    const matchClose = document.getElementById('match-close');
    const matchName = document.getElementById('match-name');
    const matchAbout = document.getElementById('match-about');
    const matchInterests = document.getElementById('match-interests');
    const enterRoom = document.getElementById('enter-room');

    const confettiCanvas = document.getElementById('confetti-canvas');
    const ctx = confettiCanvas.getContext('2d');

    const LS_KEY = 'oz_profile_v1';

    // –•—Ä–∞–Ω–∏–ª–∏—â–µ
    const saveProfile = (data) => {
      try { localStorage.setItem(LS_KEY, JSON.stringify(data)); }
      catch (e) { console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å:', e); }
    };
    const loadProfile = () => {
      try { const raw = localStorage.getItem(LS_KEY); return raw ? JSON.parse(raw) : null; }
      catch(e) { return null; }
    };
    const clearProfile = () => { try { localStorage.removeItem(LS_KEY); } catch(e){} };

    const openModal = (el) => el.classList.add('show');
    const closeModal = (el) => el.classList.remove('show');

    // FAB –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    const onScroll = () => {
      const scrolled = window.scrollY || document.documentElement.scrollTop;
      if (scrolled > 40) fab.classList.add('visible');
      else fab.classList.remove('visible');
    };
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    fab.addEventListener('click', () => {
      const data = loadProfile();
      if (data) {
        nameInput.value = data.name || '';
        interestsInput.value = (data.interests || []).join(', ');
        aboutInput.value = data.about || '';
      }
      openModal(profileModal);
    });
    profileClose.addEventListener('click', () => closeModal(profileModal));
    profileModal.addEventListener('click', (e) => { if (e.target === profileModal) closeModal(profileModal); });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    profileForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const about = aboutInput.value.trim();
      const interestsRaw = interestsInput.value.split(/[,;\n]+/).map(s => s.trim()).filter(Boolean);
      const uniq = [];
      const seen = new Set();
      for (const tag of interestsRaw) {
        const norm = tag.replace(/\s+/g, ' ').trim();
        const low = norm.toLowerCase();
        if (!seen.has(low)) { seen.add(low); uniq.push(norm); }
      }
      saveProfile({ name, about, interests: uniq });
      closeModal(profileModal);
    });

    // –°–±—Ä–æ—Å –ø—Ä–æ—Ñ–∏–ª—è
    clearProfileBtn.addEventListener('click', () => {
      clearProfile();
      nameInput.value = '';
      interestsInput.value = '';
      aboutInput.value = '';
    });

    // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏
    function resizeCanvas() {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);

    function launchConfetti({ duration = 2500, particleCount = 160 } = {}) {
      resizeCanvas();
      confettiCanvas.classList.add('show');

      const colors = ['#7CFFB2', '#5DE6FF', '#9C7CFF', '#FFD166', '#FF6B6B', '#F7B801'];
      const gravity = 0.16;
      const drag = 0.005;
      const terminalVelocity = 5;
      const ticks = 60 * (duration / 1000);

      const rand = (min, max) => Math.random() * (max - min) + min;

      const particles = [];
      for (let i = 0; i < particleCount; i++) {
        const angle = rand(-Math.PI, 0); // –≤–≤–µ—Ä—Ö —Å —Ä–∞–∑–ª—ë—Ç–æ–º
        const speed = rand(5, 12);
        particles.push({
          x: confettiCanvas.width / 2 + rand(-80, 80),
          y: confettiCanvas.height * 0.25,
          w: rand(6, 12),
          h: rand(8, 16),
          color: colors[(Math.random() * colors.length) | 0],
          tilt: rand(-0.6, 0.6),
          tiltSpeed: rand(0.02, 0.05),
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          opacity: 1,
          rotation: rand(0, Math.PI * 2),
          rotationSpeed: rand(-0.2, 0.2),
        });
      }

      let frame = 0;
      function draw() {
        ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        for (const p of particles) {
          // –§–∏–∑–∏–∫–∞
          p.vy = Math.min(p.vy + gravity, terminalVelocity);
          p.vx *= (1 - drag);
          p.x += p.vx;
          p.y += p.vy;
          p.tilt += p.tiltSpeed;
          p.rotation += p.rotationSpeed;

          // –†–∏—Å—É–µ–º –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫-–∫–æ–Ω—Ñ–µ—Ç—Ç–∏
          ctx.save();
          ctx.globalAlpha = Math.max(p.opacity, 0);
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rotation);
          ctx.fillStyle = p.color;
          ctx.fillRect(-p.w / 2, -p.h / 2 + Math.sin(p.tilt) * 2, p.w, p.h);
          ctx.restore();
        }

        frame++;
        if (frame < ticks) {
          requestAnimationFrame(draw);
        } else {
          // –ø–ª–∞–≤–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º
          confettiCanvas.classList.remove('show');
          ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        }
      }
      requestAnimationFrame(draw);
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–±–º–∏—Ç: –ø–æ–∏—Å–∫ -> –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ -> –º–µ—Ç—á
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      openModal(searchModal);

      setTimeout(() => {
        closeModal(searchModal);

        // –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
        launchConfetti({ duration: 2500, particleCount: 180 });

        // –ü–æ–∫–∞–∑–∞—Ç—å "–º–µ—Ç—á" –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (—á—Ç–æ–±—ã –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ —É—Å–ø–µ–ª–∏ –Ω–∞—á–∞—Ç—å—Å—è)
        setTimeout(() => {
          const profile = loadProfile() || { name: '–ü—É—Ç–Ω–∏–∫', about: '–í –ø—É—Ç–∏ –∫ –ò–∑—É–º—Ä—É–¥–Ω–æ–º—É –ì–æ—Ä–æ–¥—É', interests: [] };

          matchName.textContent = profile.name ? profile.name : '–ü—É—Ç–Ω–∏–∫';
          matchAbout.textContent = profile.about ? profile.about : '–ì–æ—Ç–æ–≤(–∞) –∫ –Ω–æ–≤—ã–º –æ—Ç–∫—Ä—ã—Ç–∏—è–º.';
          const interestsText = (profile.interests && profile.interests.length)
            ? profile.interests.join(', ')
            : '–Ω–æ–≤—ã–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞';
          matchInterests.textContent = interestsText;

          openModal(matchModal);
        }, 350); // –Ω–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –æ–∫–Ω–∞
      }, 2000);

      // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è —Ü–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      form.reset();
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫
    matchClose.addEventListener('click', () => closeModal(matchModal));
    matchModal.addEventListener('click', (e) => { if (e.target === matchModal) closeModal(matchModal); });

    // "–í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É" ‚Äî –∑–∞–≥–ª—É—à–∫–∞
    enterRoom.addEventListener('click', () => {
      alert('–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞! –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É: cmne.life/ozform');
      closeModal(matchModal);
    });

    // ESC –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        [matchModal, searchModal, profileModal].forEach(m => m.classList.remove('show'));
      }
    });
  </script>
</body>
</html>
